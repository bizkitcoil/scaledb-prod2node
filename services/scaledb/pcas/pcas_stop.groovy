// import org.cloudifysource.dsl.context.ServiceContextFactory
import groovy.text.SimpleTemplateEngine

// serviceContext = ServiceContextFactory.getServiceContext()
// def rem_dir=serviceContext.serviceDirectory

return true;
config = new ConfigSlurper().parse(new File("pcas-service.properties").toURL())

 //println "About to execute " + config.rem_dir + "/stop.sh "
// println "About to execute " + context.serviceDirectory + "/stop.sh "
//println "About to execute stop.sh "

new AntBuilder().sequential {	
/*
    chmod(file:config.sdir+"/scaledb_stop.sh", perm:"ugo+rx")
    touch(file:"/tmp/installationRunning")
 copy(tofile: "/home/${config.UNIX_USER}/iscaledb", file:config.sdir+"/iscaledb", overwrite:false)
    exec(executable:"chown", osfamily:"unix") {
	arg("value":"${config.UNIX_USER}:${config.UNIX_USER}")	
	arg("value":"/home/${config.UNIX_USER}/iscaledb")	
    }       
    chmod(file:"/home/${config.UNIX_USER}/iscaledb", perm:"ugo+rx")
    exec(executable:"/home/${config.UNIX_USER}/iscaledb", osfamily:"unix") {
	arg("value":"-install_all")	
	arg("value":"-mf")	
	arg("value":"/home/${config.UNIX_USER}/")	
    }
    chmod(file:"/home/${config.UNIX_USER}/iscale.manifest", perm:"ug+rw")
	exec(executable:context.serviceDirectory + "/scaledb_stop.sh", osfamily:"unix", failonerror:"false", spawn:"false") {

//    chmod(file:"${context.serviceDirectory}/scaledb_stop.sh", perm:"ugo+rx")
//	exec(executable:config.sdir + "/scaledb_stop.sh", osfamily:"unix", failonerror:"false", spawn:"false") {
//		arg("value":config.STOP_ALL)
//	}
//chmod(file:rem_dir+"/scaledb_stop.sh", perm:"ugo+rx")
//	exec(executable:config.rem_dir + "/scaledb_stop.sh", osfamily:"unix", failonerror:"false", spawn:"false") {
	}
*/
}
